{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/osmanural/flo-cltv-analiz?scriptVersionId=196229074\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"code","execution_count":1,"id":"ee91abe7","metadata":{"_cell_guid":"b1076dfc-b9ad-4769-8c92-a6c4dae69d19","_uuid":"8f2839f25d086af736a60e9eeb907d3b93b6e0e5","execution":{"iopub.execute_input":"2024-09-11T15:39:32.653379Z","iopub.status.busy":"2024-09-11T15:39:32.65281Z","iopub.status.idle":"2024-09-11T15:39:47.67137Z","shell.execute_reply":"2024-09-11T15:39:47.669912Z"},"papermill":{"duration":15.029882,"end_time":"2024-09-11T15:39:47.673949","exception":false,"start_time":"2024-09-11T15:39:32.644067","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Collecting lifetimes\r\n","  Downloading Lifetimes-0.11.3-py3-none-any.whl.metadata (4.8 kB)\r\n","Requirement already satisfied: numpy>=1.10.0 in /opt/conda/lib/python3.10/site-packages (from lifetimes) (1.26.4)\r\n","Requirement already satisfied: scipy>=1.0.0 in /opt/conda/lib/python3.10/site-packages (from lifetimes) (1.14.0)\r\n","Requirement already satisfied: pandas>=0.24.0 in /opt/conda/lib/python3.10/site-packages (from lifetimes) (2.2.2)\r\n","Collecting autograd>=1.2.0 (from lifetimes)\r\n","  Downloading autograd-1.7.0-py3-none-any.whl.metadata (7.5 kB)\r\n","Requirement already satisfied: dill>=0.2.6 in /opt/conda/lib/python3.10/site-packages (from lifetimes) (0.3.8)\r\n","Requirement already satisfied: python-dateutil>=2.8.2 in /opt/conda/lib/python3.10/site-packages (from pandas>=0.24.0->lifetimes) (2.9.0.post0)\r\n","Requirement already satisfied: pytz>=2020.1 in /opt/conda/lib/python3.10/site-packages (from pandas>=0.24.0->lifetimes) (2024.1)\r\n","Requirement already satisfied: tzdata>=2022.7 in /opt/conda/lib/python3.10/site-packages (from pandas>=0.24.0->lifetimes) (2024.1)\r\n","Requirement already satisfied: six>=1.5 in /opt/conda/lib/python3.10/site-packages (from python-dateutil>=2.8.2->pandas>=0.24.0->lifetimes) (1.16.0)\r\n","Downloading Lifetimes-0.11.3-py3-none-any.whl (584 kB)\r\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m584.2/584.2 kB\u001b[0m \u001b[31m14.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[?25hDownloading autograd-1.7.0-py3-none-any.whl (52 kB)\r\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m52.5/52.5 kB\u001b[0m \u001b[31m2.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[?25hInstalling collected packages: autograd, lifetimes\r\n","Successfully installed autograd-1.7.0 lifetimes-0.11.3\r\n","Note: you may need to restart the kernel to use updated packages.\n"]}],"source":["pip install lifetimes"]},{"cell_type":"code","execution_count":2,"id":"89356ffe","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:39:47.690325Z","iopub.status.busy":"2024-09-11T15:39:47.689893Z","iopub.status.idle":"2024-09-11T15:40:08.700433Z","shell.execute_reply":"2024-09-11T15:40:08.699163Z"},"papermill":{"duration":21.021565,"end_time":"2024-09-11T15:40:08.702844","exception":false,"start_time":"2024-09-11T15:39:47.681279","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Collecting skimpy\r\n","  Downloading skimpy-0.0.15-py3-none-any.whl.metadata (28 kB)\r\n","Requirement already satisfied: Pygments<3.0.0,>=2.10.0 in /opt/conda/lib/python3.10/site-packages (from skimpy) (2.18.0)\r\n","Requirement already satisfied: click<9.0.0,>=8.1.6 in /opt/conda/lib/python3.10/site-packages (from skimpy) (8.1.7)\r\n","Requirement already satisfied: ipykernel<7.0.0,>=6.7.0 in /opt/conda/lib/python3.10/site-packages (from skimpy) (6.29.4)\r\n","Requirement already satisfied: numpy<2.0.0,>=1.22.2 in /opt/conda/lib/python3.10/site-packages (from skimpy) (1.26.4)\r\n","Requirement already satisfied: pandas<3.0.0,>=2.0.3 in /opt/conda/lib/python3.10/site-packages (from skimpy) (2.2.2)\r\n","Collecting polars<0.21,>=0.19 (from skimpy)\r\n","  Downloading polars-0.20.31-cp38-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (14 kB)\r\n","Collecting pyarrow<17,>=13 (from skimpy)\r\n","  Downloading pyarrow-16.1.0-cp310-cp310-manylinux_2_28_x86_64.whl.metadata (3.0 kB)\r\n","Requirement already satisfied: rich<14.0,>=10.9 in /opt/conda/lib/python3.10/site-packages (from skimpy) (13.7.1)\r\n","Collecting typeguard==4.2.1 (from skimpy)\r\n","  Downloading typeguard-4.2.1-py3-none-any.whl.metadata (3.7 kB)\r\n","Requirement already satisfied: typing-extensions>=4.10.0 in /opt/conda/lib/python3.10/site-packages (from typeguard==4.2.1->skimpy) (4.12.2)\r\n","Requirement already satisfied: comm>=0.1.1 in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (0.2.2)\r\n","Requirement already satisfied: debugpy>=1.6.5 in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (1.8.1)\r\n","Requirement already satisfied: ipython>=7.23.1 in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (8.21.0)\r\n","Requirement already satisfied: jupyter-client>=6.1.12 in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (7.4.9)\r\n","Requirement already satisfied: jupyter-core!=5.0.*,>=4.12 in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (5.7.2)\r\n","Requirement already satisfied: matplotlib-inline>=0.1 in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (0.1.7)\r\n","Requirement already satisfied: nest-asyncio in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (1.6.0)\r\n","Requirement already satisfied: packaging in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (21.3)\r\n","Requirement already satisfied: psutil in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (5.9.3)\r\n","Requirement already satisfied: pyzmq>=24 in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (26.0.3)\r\n","Requirement already satisfied: tornado>=6.1 in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (6.4.1)\r\n","Requirement already satisfied: traitlets>=5.4.0 in /opt/conda/lib/python3.10/site-packages (from ipykernel<7.0.0,>=6.7.0->skimpy) (5.14.3)\r\n","Requirement already satisfied: python-dateutil>=2.8.2 in /opt/conda/lib/python3.10/site-packages (from pandas<3.0.0,>=2.0.3->skimpy) (2.9.0.post0)\r\n","Requirement already satisfied: pytz>=2020.1 in /opt/conda/lib/python3.10/site-packages (from pandas<3.0.0,>=2.0.3->skimpy) (2024.1)\r\n","Requirement already satisfied: tzdata>=2022.7 in /opt/conda/lib/python3.10/site-packages (from pandas<3.0.0,>=2.0.3->skimpy) (2024.1)\r\n","Requirement already satisfied: markdown-it-py>=2.2.0 in /opt/conda/lib/python3.10/site-packages (from rich<14.0,>=10.9->skimpy) (3.0.0)\r\n","Requirement already satisfied: decorator in /opt/conda/lib/python3.10/site-packages (from ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (5.1.1)\r\n","Requirement already satisfied: jedi>=0.16 in /opt/conda/lib/python3.10/site-packages (from ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (0.19.1)\r\n","Requirement already satisfied: prompt-toolkit<3.1.0,>=3.0.41 in /opt/conda/lib/python3.10/site-packages (from ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (3.0.47)\r\n","Requirement already satisfied: stack-data in /opt/conda/lib/python3.10/site-packages (from ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (0.6.2)\r\n","Requirement already satisfied: exceptiongroup in /opt/conda/lib/python3.10/site-packages (from ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (1.2.0)\r\n","Requirement already satisfied: pexpect>4.3 in /opt/conda/lib/python3.10/site-packages (from ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (4.9.0)\r\n","Requirement already satisfied: entrypoints in /opt/conda/lib/python3.10/site-packages (from jupyter-client>=6.1.12->ipykernel<7.0.0,>=6.7.0->skimpy) (0.4)\r\n","Requirement already satisfied: platformdirs>=2.5 in /opt/conda/lib/python3.10/site-packages (from jupyter-core!=5.0.*,>=4.12->ipykernel<7.0.0,>=6.7.0->skimpy) (3.11.0)\r\n","Requirement already satisfied: mdurl~=0.1 in /opt/conda/lib/python3.10/site-packages (from markdown-it-py>=2.2.0->rich<14.0,>=10.9->skimpy) (0.1.2)\r\n","Requirement already satisfied: six>=1.5 in /opt/conda/lib/python3.10/site-packages (from python-dateutil>=2.8.2->pandas<3.0.0,>=2.0.3->skimpy) (1.16.0)\r\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /opt/conda/lib/python3.10/site-packages (from packaging->ipykernel<7.0.0,>=6.7.0->skimpy) (3.1.2)\r\n","Requirement already satisfied: parso<0.9.0,>=0.8.3 in /opt/conda/lib/python3.10/site-packages (from jedi>=0.16->ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (0.8.4)\r\n","Requirement already satisfied: ptyprocess>=0.5 in /opt/conda/lib/python3.10/site-packages (from pexpect>4.3->ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (0.7.0)\r\n","Requirement already satisfied: wcwidth in /opt/conda/lib/python3.10/site-packages (from prompt-toolkit<3.1.0,>=3.0.41->ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (0.2.13)\r\n","Requirement already satisfied: executing>=1.2.0 in /opt/conda/lib/python3.10/site-packages (from stack-data->ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (2.0.1)\r\n","Requirement already satisfied: asttokens>=2.1.0 in /opt/conda/lib/python3.10/site-packages (from stack-data->ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (2.4.1)\r\n","Requirement already satisfied: pure-eval in /opt/conda/lib/python3.10/site-packages (from stack-data->ipython>=7.23.1->ipykernel<7.0.0,>=6.7.0->skimpy) (0.2.2)\r\n","Downloading skimpy-0.0.15-py3-none-any.whl (16 kB)\r\n","Downloading typeguard-4.2.1-py3-none-any.whl (34 kB)\r\n","Downloading polars-0.20.31-cp38-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (28.8 MB)\r\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m28.8/28.8 MB\u001b[0m \u001b[31m49.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[?25hDownloading pyarrow-16.1.0-cp310-cp310-manylinux_2_28_x86_64.whl (40.8 MB)\r\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m40.8/40.8 MB\u001b[0m \u001b[31m37.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\r\n","\u001b[?25hInstalling collected packages: typeguard, pyarrow, polars, skimpy\r\n","  Attempting uninstall: typeguard\r\n","    Found existing installation: typeguard 4.3.0\r\n","    Uninstalling typeguard-4.3.0:\r\n","      Successfully uninstalled typeguard-4.3.0\r\n","  Attempting uninstall: pyarrow\r\n","    Found existing installation: pyarrow 17.0.0\r\n","    Uninstalling pyarrow-17.0.0:\r\n","      Successfully uninstalled pyarrow-17.0.0\r\n","  Attempting uninstall: polars\r\n","    Found existing installation: polars 1.5.0\r\n","    Uninstalling polars-1.5.0:\r\n","      Successfully uninstalled polars-1.5.0\r\n","\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\r\n","apache-beam 2.46.0 requires cloudpickle~=2.2.1, but you have cloudpickle 3.0.0 which is incompatible.\r\n","apache-beam 2.46.0 requires dill<0.3.2,>=0.3.1.1, but you have dill 0.3.8 which is incompatible.\r\n","apache-beam 2.46.0 requires numpy<1.25.0,>=1.14.3, but you have numpy 1.26.4 which is incompatible.\r\n","apache-beam 2.46.0 requires pyarrow<10.0.0,>=3.0.0, but you have pyarrow 16.1.0 which is incompatible.\r\n","beatrix-jupyterlab 2024.66.154055 requires jupyterlab~=3.6.0, but you have jupyterlab 4.2.4 which is incompatible.\r\n","ibis-framework 7.1.0 requires pyarrow<15,>=2, but you have pyarrow 16.1.0 which is incompatible.\r\n","ydata-profiling 4.9.0 requires scipy<1.14,>=1.4.1, but you have scipy 1.14.0 which is incompatible.\u001b[0m\u001b[31m\r\n","\u001b[0mSuccessfully installed polars-0.20.31 pyarrow-16.1.0 skimpy-0.0.15 typeguard-4.2.1\r\n","Note: you may need to restart the kernel to use updated packages.\n"]}],"source":["pip install skimpy"]},{"cell_type":"code","execution_count":3,"id":"296c4c44","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:08.725198Z","iopub.status.busy":"2024-09-11T15:40:08.724751Z","iopub.status.idle":"2024-09-11T15:40:11.320134Z","shell.execute_reply":"2024-09-11T15:40:11.318715Z"},"papermill":{"duration":2.609996,"end_time":"2024-09-11T15:40:11.323099","exception":false,"start_time":"2024-09-11T15:40:08.713103","status":"completed"},"tags":[]},"outputs":[],"source":["import matplotlib.pyplot as plt\n","from lifetimes import BetaGeoFitter\n","from lifetimes import GammaGammaFitter\n","from lifetimes.plotting import plot_period_transactions\n","import pandas as pd\n","from sklearn.preprocessing import MinMaxScaler\n","import numpy as np\n","import datetime as dt\n","pd.set_option(\"display.max_columns\",None)\n","pd.set_option(\"display.width\",500)\n","pd.set_option(\"display.float_format\",lambda x: \"%3f\" % x)\n","from skimpy import skim"]},{"cell_type":"code","execution_count":4,"id":"7580902b","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:11.345994Z","iopub.status.busy":"2024-09-11T15:40:11.34475Z","iopub.status.idle":"2024-09-11T15:40:11.507842Z","shell.execute_reply":"2024-09-11T15:40:11.506688Z"},"papermill":{"duration":0.177064,"end_time":"2024-09-11T15:40:11.510355","exception":false,"start_time":"2024-09-11T15:40:11.333291","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["master_id                            0\n","order_channel                        0\n","last_order_channel                   0\n","first_order_date                     0\n","last_order_date                      0\n","last_order_date_online               0\n","last_order_date_offline              0\n","order_num_total_ever_online          0\n","order_num_total_ever_offline         0\n","customer_value_total_ever_offline    0\n","customer_value_total_ever_online     0\n","interested_in_categories_12          0\n","dtype: int64"]},"execution_count":4,"metadata":{},"output_type":"execute_result"}],"source":["\n","###############################################################\n","# GÖREVLER\n","###############################################################\n","# GÖREV 1: Veriyi Hazırlama\n","           # 1. flo_data_20K.csv verisini okuyunuz.Dataframe’in kopyasını oluşturunuz.\n","\n","\n","data=pd.read_csv(\"/kaggle/input/flo-dataset/flo_data.csv\")\n","datacopy=data.copy()\n","datacopy.head()\n","datacopy.describe().T\n","datacopy.isnull().sum()"]},{"cell_type":"code","execution_count":5,"id":"1eb5a65b","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:11.532598Z","iopub.status.busy":"2024-09-11T15:40:11.532152Z","iopub.status.idle":"2024-09-11T15:40:11.802163Z","shell.execute_reply":"2024-09-11T15:40:11.800759Z"},"papermill":{"duration":0.283888,"end_time":"2024-09-11T15:40:11.804641","exception":false,"start_time":"2024-09-11T15:40:11.520753","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">╭──────────────────────────────────────────────── skimpy summary ─────────────────────────────────────────────────╮\n","│ <span style=\"font-style: italic\">         Data Summary         </span> <span style=\"font-style: italic\">      Data Types       </span>                                                          │\n","│ ┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓ ┏━━━━━━━━━━━━━┳━━━━━━━┓                                                          │\n","│ ┃<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\"> dataframe         </span>┃<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\"> Values </span>┃ ┃<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\"> Column Type </span>┃<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\"> Count </span>┃                                                          │\n","│ ┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩ ┡━━━━━━━━━━━━━╇━━━━━━━┩                                                          │\n","│ │ Number of rows    │ 19945  │ │ string      │ 8     │                                                          │\n","│ │ Number of columns │ 12     │ │ float64     │ 4     │                                                          │\n","│ └───────────────────┴────────┘ └─────────────┴───────┘                                                          │\n","│ <span style=\"font-style: italic\">                                                    number                                                    </span>  │\n","│ ┏━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━━┓  │\n","│ ┃<span style=\"font-weight: bold\"> column_name             </span>┃<span style=\"font-weight: bold\"> NA  </span>┃<span style=\"font-weight: bold\"> NA %  </span>┃<span style=\"font-weight: bold\"> mean   </span>┃<span style=\"font-weight: bold\"> sd     </span>┃<span style=\"font-weight: bold\"> p0     </span>┃<span style=\"font-weight: bold\"> p25    </span>┃<span style=\"font-weight: bold\"> p50   </span>┃<span style=\"font-weight: bold\"> p75   </span>┃<span style=\"font-weight: bold\"> p100  </span>┃<span style=\"font-weight: bold\"> hist   </span>┃  │\n","│ ┡━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━━┩  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">order_num_total_ever_on</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">  0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\"> 3.111</span> │ <span style=\"color: #008080; text-decoration-color: #008080\"> 4.226</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">     1</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">     1</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    2</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    4</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">  200</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">  ▇   </span> │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">line                   </span> │     │       │        │        │        │        │       │       │       │        │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">order_num_total_ever_of</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">  0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\"> 1.914</span> │ <span style=\"color: #008080; text-decoration-color: #008080\"> 2.063</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">     1</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">     1</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    1</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    2</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">  109</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">  ▇   </span> │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">fline                  </span> │     │       │        │        │        │        │       │       │       │        │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">customer_value_total_ev</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">  0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\"> 253.9</span> │ <span style=\"color: #008080; text-decoration-color: #008080\"> 301.5</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    10</span> │ <span style=\"color: #008080; text-decoration-color: #008080\"> 99.99</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">  180</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">  320</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">18120</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">  ▇   </span> │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">er_offline             </span> │     │       │        │        │        │        │       │       │       │        │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">customer_value_total_ev</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">  0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\"> 497.3</span> │ <span style=\"color: #008080; text-decoration-color: #008080\"> 832.6</span> │ <span style=\"color: #008080; text-decoration-color: #008080\"> 12.99</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">   150</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">286.5</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">578.4</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">45220</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">  ▇   </span> │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">er_online              </span> │     │       │        │        │        │        │       │       │       │        │  │\n","│ └─────────────────────────┴─────┴───────┴────────┴────────┴────────┴────────┴───────┴───────┴───────┴────────┘  │\n","│ <span style=\"font-style: italic\">                                                    string                                                    </span>  │\n","│ ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓  │\n","│ ┃<span style=\"font-weight: bold\"> column_name                           </span>┃<span style=\"font-weight: bold\"> NA    </span>┃<span style=\"font-weight: bold\"> NA %      </span>┃<span style=\"font-weight: bold\"> words per row            </span>┃<span style=\"font-weight: bold\"> total words         </span>┃  │\n","│ ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">master_id                            </span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">        0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">                       1</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">              19945</span> │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">order_channel                        </span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">        0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">                     1.6</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">              32273</span> │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">last_order_channel                   </span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">        0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">                     1.4</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">              28424</span> │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">first_order_date                     </span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">        0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">                       1</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">              19945</span> │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">last_order_date                      </span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">        0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">                       1</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">              19945</span> │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">last_order_date_online               </span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">        0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">                       1</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">              19945</span> │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">last_order_date_offline              </span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">        0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">                       1</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">              19945</span> │  │\n","│ │ <span style=\"color: #af87ff; text-decoration-color: #af87ff\">interested_in_categories_12          </span> │ <span style=\"color: #008080; text-decoration-color: #008080\">    0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">        0</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">                     1.7</span> │ <span style=\"color: #008080; text-decoration-color: #008080\">              33178</span> │  │\n","│ └───────────────────────────────────────┴───────┴───────────┴──────────────────────────┴─────────────────────┘  │\n","╰────────────────────────────────────────────────────── End ──────────────────────────────────────────────────────╯\n","</pre>\n"],"text/plain":["╭──────────────────────────────────────────────── skimpy summary ─────────────────────────────────────────────────╮\n","│ \u001b[3m         Data Summary         \u001b[0m \u001b[3m      Data Types       \u001b[0m                                                          │\n","│ ┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓ ┏━━━━━━━━━━━━━┳━━━━━━━┓                                                          │\n","│ ┃\u001b[1;36m \u001b[0m\u001b[1;36mdataframe        \u001b[0m\u001b[1;36m \u001b[0m┃\u001b[1;36m \u001b[0m\u001b[1;36mValues\u001b[0m\u001b[1;36m \u001b[0m┃ ┃\u001b[1;36m \u001b[0m\u001b[1;36mColumn Type\u001b[0m\u001b[1;36m \u001b[0m┃\u001b[1;36m \u001b[0m\u001b[1;36mCount\u001b[0m\u001b[1;36m \u001b[0m┃                                                          │\n","│ ┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩ ┡━━━━━━━━━━━━━╇━━━━━━━┩                                                          │\n","│ │ Number of rows    │ 19945  │ │ string      │ 8     │                                                          │\n","│ │ Number of columns │ 12     │ │ float64     │ 4     │                                                          │\n","│ └───────────────────┴────────┘ └─────────────┴───────┘                                                          │\n","│ \u001b[3m                                                    number                                                    \u001b[0m  │\n","│ ┏━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━━┓  │\n","│ ┃\u001b[1m \u001b[0m\u001b[1mcolumn_name            \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mNA \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mNA % \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mmean  \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1msd    \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mp0    \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mp25   \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mp50  \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mp75  \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mp100 \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mhist  \u001b[0m\u001b[1m \u001b[0m┃  │\n","│ ┡━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━━┩  │\n","│ │ \u001b[38;5;141morder_num_total_ever_on\u001b[0m │ \u001b[36m  0\u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m 3.111\u001b[0m │ \u001b[36m 4.226\u001b[0m │ \u001b[36m     1\u001b[0m │ \u001b[36m     1\u001b[0m │ \u001b[36m    2\u001b[0m │ \u001b[36m    4\u001b[0m │ \u001b[36m  200\u001b[0m │ \u001b[32m  ▇   \u001b[0m │  │\n","│ │ \u001b[38;5;141mline                   \u001b[0m │     │       │        │        │        │        │       │       │       │        │  │\n","│ │ \u001b[38;5;141morder_num_total_ever_of\u001b[0m │ \u001b[36m  0\u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m 1.914\u001b[0m │ \u001b[36m 2.063\u001b[0m │ \u001b[36m     1\u001b[0m │ \u001b[36m     1\u001b[0m │ \u001b[36m    1\u001b[0m │ \u001b[36m    2\u001b[0m │ \u001b[36m  109\u001b[0m │ \u001b[32m  ▇   \u001b[0m │  │\n","│ │ \u001b[38;5;141mfline                  \u001b[0m │     │       │        │        │        │        │       │       │       │        │  │\n","│ │ \u001b[38;5;141mcustomer_value_total_ev\u001b[0m │ \u001b[36m  0\u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m 253.9\u001b[0m │ \u001b[36m 301.5\u001b[0m │ \u001b[36m    10\u001b[0m │ \u001b[36m 99.99\u001b[0m │ \u001b[36m  180\u001b[0m │ \u001b[36m  320\u001b[0m │ \u001b[36m18120\u001b[0m │ \u001b[32m  ▇   \u001b[0m │  │\n","│ │ \u001b[38;5;141mer_offline             \u001b[0m │     │       │        │        │        │        │       │       │       │        │  │\n","│ │ \u001b[38;5;141mcustomer_value_total_ev\u001b[0m │ \u001b[36m  0\u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m 497.3\u001b[0m │ \u001b[36m 832.6\u001b[0m │ \u001b[36m 12.99\u001b[0m │ \u001b[36m   150\u001b[0m │ \u001b[36m286.5\u001b[0m │ \u001b[36m578.4\u001b[0m │ \u001b[36m45220\u001b[0m │ \u001b[32m  ▇   \u001b[0m │  │\n","│ │ \u001b[38;5;141mer_online              \u001b[0m │     │       │        │        │        │        │       │       │       │        │  │\n","│ └─────────────────────────┴─────┴───────┴────────┴────────┴────────┴────────┴───────┴───────┴───────┴────────┘  │\n","│ \u001b[3m                                                    string                                                    \u001b[0m  │\n","│ ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓  │\n","│ ┃\u001b[1m \u001b[0m\u001b[1mcolumn_name                          \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mNA   \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mNA %     \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mwords per row           \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mtotal words        \u001b[0m\u001b[1m \u001b[0m┃  │\n","│ ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩  │\n","│ │ \u001b[38;5;141mmaster_id                            \u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m        0\u001b[0m │ \u001b[36m                       1\u001b[0m │ \u001b[36m              19945\u001b[0m │  │\n","│ │ \u001b[38;5;141morder_channel                        \u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m        0\u001b[0m │ \u001b[36m                     1.6\u001b[0m │ \u001b[36m              32273\u001b[0m │  │\n","│ │ \u001b[38;5;141mlast_order_channel                   \u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m        0\u001b[0m │ \u001b[36m                     1.4\u001b[0m │ \u001b[36m              28424\u001b[0m │  │\n","│ │ \u001b[38;5;141mfirst_order_date                     \u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m        0\u001b[0m │ \u001b[36m                       1\u001b[0m │ \u001b[36m              19945\u001b[0m │  │\n","│ │ \u001b[38;5;141mlast_order_date                      \u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m        0\u001b[0m │ \u001b[36m                       1\u001b[0m │ \u001b[36m              19945\u001b[0m │  │\n","│ │ \u001b[38;5;141mlast_order_date_online               \u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m        0\u001b[0m │ \u001b[36m                       1\u001b[0m │ \u001b[36m              19945\u001b[0m │  │\n","│ │ \u001b[38;5;141mlast_order_date_offline              \u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m        0\u001b[0m │ \u001b[36m                       1\u001b[0m │ \u001b[36m              19945\u001b[0m │  │\n","│ │ \u001b[38;5;141minterested_in_categories_12          \u001b[0m │ \u001b[36m    0\u001b[0m │ \u001b[36m        0\u001b[0m │ \u001b[36m                     1.7\u001b[0m │ \u001b[36m              33178\u001b[0m │  │\n","│ └───────────────────────────────────────┴───────┴───────────┴──────────────────────────┴─────────────────────┘  │\n","╰────────────────────────────────────────────────────── End ──────────────────────────────────────────────────────╯\n"]},"metadata":{},"output_type":"display_data"}],"source":["skim(datacopy)"]},{"cell_type":"code","execution_count":6,"id":"a3d9feaa","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:11.827775Z","iopub.status.busy":"2024-09-11T15:40:11.827326Z","iopub.status.idle":"2024-09-11T15:40:11.834922Z","shell.execute_reply":"2024-09-11T15:40:11.833607Z"},"papermill":{"duration":0.021753,"end_time":"2024-09-11T15:40:11.837189","exception":false,"start_time":"2024-09-11T15:40:11.815436","status":"completed"},"tags":[]},"outputs":[],"source":["\n","# 2. Aykırı değerleri baskılamak için gerekli olan outlier_thresholds ve replace_with_thresholds fonksiyonlarını tanımlayınız.\n","           # Not: cltv hesaplanırken frequency değerleri integer olması gerekmektedir.Bu nedenle alt ve üst limitlerini round() ile yuvarlayınız.\n","def outlier_threshold(dataframe,variable):\n","    quartile1=dataframe[variable].quantile(0.01)\n","    quartile3=dataframe[variable].quantile(0.99)\n","    interquantile_range=quartile3-quartile1\n","    up_limit=(quartile3+1.5 * interquantile_range)\n","    low_limit=quartile1 + 1.5 * interquantile_range\n","    return low_limit,up_limit\n","\n","def replace_with_threshold(dataframe,variable):\n","    low_limit,up_limit=outlier_threshold(dataframe,variable)\n","    #dataframe.loc[(dataframe[variable] < low_limit), variable]= low_limit\n","    dataframe.loc[(dataframe[variable] > up_limit), variable]= up_limit\n","    if variable == 'frequency':  # frequency'nin yuvarlanması\n","        dataframe[variable] = dataframe[variable].round()"]},{"cell_type":"code","execution_count":7,"id":"fee7229f","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:11.859992Z","iopub.status.busy":"2024-09-11T15:40:11.85955Z","iopub.status.idle":"2024-09-11T15:40:11.89911Z","shell.execute_reply":"2024-09-11T15:40:11.897844Z"},"papermill":{"duration":0.053774,"end_time":"2024-09-11T15:40:11.901621","exception":false,"start_time":"2024-09-11T15:40:11.847847","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>count</th>\n","      <th>mean</th>\n","      <th>std</th>\n","      <th>min</th>\n","      <th>25%</th>\n","      <th>50%</th>\n","      <th>75%</th>\n","      <th>max</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>order_num_total_ever_online</th>\n","      <td>19945.000000</td>\n","      <td>3.092304</td>\n","      <td>3.813699</td>\n","      <td>1.000000</td>\n","      <td>1.000000</td>\n","      <td>2.000000</td>\n","      <td>4.000000</td>\n","      <td>48.500000</td>\n","    </tr>\n","    <tr>\n","      <th>order_num_total_ever_offline</th>\n","      <td>19945.000000</td>\n","      <td>1.886187</td>\n","      <td>1.434694</td>\n","      <td>1.000000</td>\n","      <td>1.000000</td>\n","      <td>1.000000</td>\n","      <td>2.000000</td>\n","      <td>16.000000</td>\n","    </tr>\n","    <tr>\n","      <th>customer_value_total_ever_offline</th>\n","      <td>19945.000000</td>\n","      <td>251.921220</td>\n","      <td>251.022560</td>\n","      <td>10.000000</td>\n","      <td>99.990000</td>\n","      <td>179.980000</td>\n","      <td>319.970000</td>\n","      <td>3019.882000</td>\n","    </tr>\n","    <tr>\n","      <th>customer_value_total_ever_online</th>\n","      <td>19945.000000</td>\n","      <td>489.705377</td>\n","      <td>632.606387</td>\n","      <td>12.990000</td>\n","      <td>149.980000</td>\n","      <td>286.460000</td>\n","      <td>578.440000</td>\n","      <td>7799.541000</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                                         count       mean        std       min        25%        50%        75%         max\n","order_num_total_ever_online       19945.000000   3.092304   3.813699  1.000000   1.000000   2.000000   4.000000   48.500000\n","order_num_total_ever_offline      19945.000000   1.886187   1.434694  1.000000   1.000000   1.000000   2.000000   16.000000\n","customer_value_total_ever_offline 19945.000000 251.921220 251.022560 10.000000  99.990000 179.980000 319.970000 3019.882000\n","customer_value_total_ever_online  19945.000000 489.705377 632.606387 12.990000 149.980000 286.460000 578.440000 7799.541000"]},"execution_count":7,"metadata":{},"output_type":"execute_result"}],"source":["\n","# 3. \"order_num_total_ever_online\",\"order_num_total_ever_offline\",\"customer_value_total_ever_offline\",\n","# \"customer_value_total_ever_online\" değişkenlerinin\n","# aykırı değerleri varsa baskılayanız.\n","\n","replace_with_threshold(datacopy,\"order_num_total_ever_online\")\n","replace_with_threshold(datacopy,\"order_num_total_ever_offline\")\n","replace_with_threshold(datacopy,\"customer_value_total_ever_offline\")\n","replace_with_threshold(datacopy,\"customer_value_total_ever_online\")\n","datacopy.describe().T"]},{"cell_type":"code","execution_count":8,"id":"731e8cb6","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:11.927196Z","iopub.status.busy":"2024-09-11T15:40:11.925691Z","iopub.status.idle":"2024-09-11T15:40:11.934962Z","shell.execute_reply":"2024-09-11T15:40:11.933689Z"},"papermill":{"duration":0.024607,"end_time":"2024-09-11T15:40:11.937735","exception":false,"start_time":"2024-09-11T15:40:11.913128","status":"completed"},"tags":[]},"outputs":[],"source":["\n","# 4. Omnichannel müşterilerin hem online'dan hemde offline platformlardan alışveriş yaptığını ifade etmektedir. Herbir müşterinin toplam\n","# alışveriş sayısı ve harcaması için yeni değişkenler oluşturun.\n","\n","\n","datacopy[\"Omnichannel_Counts\"]=datacopy[\"order_num_total_ever_online\"]+datacopy[\"order_num_total_ever_offline\"]\n","datacopy[\"Omnichannel_Price\"]=datacopy[\"customer_value_total_ever_offline\"]+datacopy[\"customer_value_total_ever_online\"]"]},{"cell_type":"code","execution_count":9,"id":"4241e2a1","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:11.961362Z","iopub.status.busy":"2024-09-11T15:40:11.960939Z","iopub.status.idle":"2024-09-11T15:40:12.011208Z","shell.execute_reply":"2024-09-11T15:40:12.00966Z"},"papermill":{"duration":0.065217,"end_time":"2024-09-11T15:40:12.013692","exception":false,"start_time":"2024-09-11T15:40:11.948475","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["<class 'pandas.core.frame.DataFrame'>\n","RangeIndex: 19945 entries, 0 to 19944\n","Data columns (total 14 columns):\n"," #   Column                             Non-Null Count  Dtype         \n","---  ------                             --------------  -----         \n"," 0   master_id                          19945 non-null  object        \n"," 1   order_channel                      19945 non-null  object        \n"," 2   last_order_channel                 19945 non-null  object        \n"," 3   first_order_date                   19945 non-null  datetime64[ns]\n"," 4   last_order_date                    19945 non-null  datetime64[ns]\n"," 5   last_order_date_online             19945 non-null  datetime64[ns]\n"," 6   last_order_date_offline            19945 non-null  datetime64[ns]\n"," 7   order_num_total_ever_online        19945 non-null  float64       \n"," 8   order_num_total_ever_offline       19945 non-null  float64       \n"," 9   customer_value_total_ever_offline  19945 non-null  float64       \n"," 10  customer_value_total_ever_online   19945 non-null  float64       \n"," 11  interested_in_categories_12        19945 non-null  object        \n"," 12  Omnichannel_Counts                 19945 non-null  float64       \n"," 13  Omnichannel_Price                  19945 non-null  float64       \n","dtypes: datetime64[ns](4), float64(6), object(4)\n","memory usage: 2.1+ MB\n"]}],"source":["\n","for i in datacopy.columns:\n","    if \"date\" in i:\n","        datacopy[i]=pd.to_datetime(datacopy[i])\n","\n","\n","\n","datacopy.info()\n"]},{"cell_type":"code","execution_count":10,"id":"98dbf0e3","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:12.037212Z","iopub.status.busy":"2024-09-11T15:40:12.036776Z","iopub.status.idle":"2024-09-11T15:40:12.043799Z","shell.execute_reply":"2024-09-11T15:40:12.042481Z"},"papermill":{"duration":0.021613,"end_time":"2024-09-11T15:40:12.046185","exception":false,"start_time":"2024-09-11T15:40:12.024572","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["2021-05-30 00:00:00\n"]}],"source":["\n","# GÖREV 2: CLTV Veri Yapısının Oluşturulması\n","# 1.Veri setindeki en son alışverişin yapıldığı tarihten 2 gün sonrasını analiz tarihi olarak alınız.\n","\n","print(datacopy[\"last_order_date\"].max())\n","today_date=dt.datetime(2021,6,1)"]},{"cell_type":"markdown","id":"fc0e6481","metadata":{"papermill":{"duration":0.01055,"end_time":"2024-09-11T15:40:12.067751","exception":false,"start_time":"2024-09-11T15:40:12.057201","status":"completed"},"tags":[]},"source":["CLTV --> Bir müşterinin bir şirketle kurduğu ilişki-iletişim süresince bu şirkete kazandırdığı parasal değerdir.\n","\n","CLTV= (Customer Value/ Churn Rate)*Profit Margin  formülü ile hesaplanır.\n"]},{"cell_type":"code","execution_count":11,"id":"3c76b9c9","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:12.092807Z","iopub.status.busy":"2024-09-11T15:40:12.091753Z","iopub.status.idle":"2024-09-11T15:40:12.112888Z","shell.execute_reply":"2024-09-11T15:40:12.111531Z"},"papermill":{"duration":0.036181,"end_time":"2024-09-11T15:40:12.115389","exception":false,"start_time":"2024-09-11T15:40:12.079208","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>master_id</th>\n","      <th>recency_cltv_weekly</th>\n","      <th>T_weekly</th>\n","      <th>frequency</th>\n","      <th>monetary_cltv_avg</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>cc294636-19f0-11eb-8d74-000d3a38a36f</td>\n","      <td>119</td>\n","      <td>214</td>\n","      <td>5.000000</td>\n","      <td>939.370000</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>f431bd5a-ab7b-11e9-a2fc-000d3a38a36f</td>\n","      <td>1469</td>\n","      <td>1574</td>\n","      <td>21.000000</td>\n","      <td>2013.550000</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>69b69676-1a40-11ea-941b-000d3a38a36f</td>\n","      <td>366</td>\n","      <td>552</td>\n","      <td>5.000000</td>\n","      <td>585.320000</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1854e56c-491f-11eb-806e-000d3a38a36f</td>\n","      <td>11</td>\n","      <td>146</td>\n","      <td>2.000000</td>\n","      <td>121.970000</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>d6ea1074-f1f5-11e9-9346-000d3a38a36f</td>\n","      <td>582</td>\n","      <td>668</td>\n","      <td>2.000000</td>\n","      <td>209.980000</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                              master_id  recency_cltv_weekly  T_weekly  frequency  monetary_cltv_avg\n","0  cc294636-19f0-11eb-8d74-000d3a38a36f                  119       214   5.000000         939.370000\n","1  f431bd5a-ab7b-11e9-a2fc-000d3a38a36f                 1469      1574  21.000000        2013.550000\n","2  69b69676-1a40-11ea-941b-000d3a38a36f                  366       552   5.000000         585.320000\n","3  1854e56c-491f-11eb-806e-000d3a38a36f                   11       146   2.000000         121.970000\n","4  d6ea1074-f1f5-11e9-9346-000d3a38a36f                  582       668   2.000000         209.980000"]},"execution_count":11,"metadata":{},"output_type":"execute_result"}],"source":["\n","# 2.customer_id, recency_cltv_weekly, T_weekly, frequency ve monetary_cltv_avg değerlerinin yer aldığı yeni bir cltv dataframe'i oluşturunuz.\n","\n","cltv_df=pd.DataFrame()\n","cltv_df[\"master_id\"]=datacopy[\"master_id\"]\n","cltv_df[\"recency_cltv_weekly\"]=(datacopy[\"last_order_date\"]-datacopy[\"first_order_date\"]).dt.days\n","cltv_df[\"T_weekly\"]=(today_date-datacopy[\"first_order_date\"]).dt.days\n","cltv_df[\"frequency\"]=datacopy[\"Omnichannel_Counts\"]\n","cltv_df[\"monetary_cltv_avg\"]=datacopy[\"Omnichannel_Price\"]\n","\n","cltv_df.head()"]},{"cell_type":"markdown","id":"a684de78","metadata":{"papermill":{"duration":0.010927,"end_time":"2024-09-11T15:40:12.138273","exception":false,"start_time":"2024-09-11T15:40:12.127346","status":"completed"},"tags":[]},"source":["RFM analizde recency değeri günlük olarak hesaplanırken CLTV analizinde haftalık olarak hesaplanır.\n","\n","**Recency** = Son satın alma üzerinden geçen zaman. Son tarih - ilk tarih.                             \n","**T**: Müşterinin yaşı. Haftalık ( analiz tarihi ile ilk satın aldığı tarih arasındaki fark)         \n","**frequency **= tekrar eden  toplam satın alma sayısı, 1 den büyük olmalıdır. En az 2 kere gelmesi o firmanın müşterisi kabul edilir.                                                                    \n","**monatary_value** = satın alma başına ortalama kazanç. Fiyatın satın alma sayısına bölünmesi ile bulunur.Rfm analizinde direkt olarak fiyatı baz alıyoruzç"]},{"cell_type":"markdown","id":"b19db1af","metadata":{"papermill":{"duration":0.010868,"end_time":"2024-09-11T15:40:12.160139","exception":false,"start_time":"2024-09-11T15:40:12.149271","status":"completed"},"tags":[]},"source":[]},{"cell_type":"code","execution_count":12,"id":"1657c03f","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:12.1856Z","iopub.status.busy":"2024-09-11T15:40:12.184656Z","iopub.status.idle":"2024-09-11T15:40:12.201421Z","shell.execute_reply":"2024-09-11T15:40:12.200156Z"},"papermill":{"duration":0.032284,"end_time":"2024-09-11T15:40:12.204136","exception":false,"start_time":"2024-09-11T15:40:12.171852","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>master_id</th>\n","      <th>recency_cltv_weekly</th>\n","      <th>T_weekly</th>\n","      <th>frequency</th>\n","      <th>monetary_cltv_avg</th>\n","      <th>monetart_cltv_avg</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>cc294636-19f0-11eb-8d74-000d3a38a36f</td>\n","      <td>17.000000</td>\n","      <td>30.571429</td>\n","      <td>5.000000</td>\n","      <td>939.370000</td>\n","      <td>187.874000</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>f431bd5a-ab7b-11e9-a2fc-000d3a38a36f</td>\n","      <td>209.857143</td>\n","      <td>224.857143</td>\n","      <td>21.000000</td>\n","      <td>2013.550000</td>\n","      <td>95.883333</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>69b69676-1a40-11ea-941b-000d3a38a36f</td>\n","      <td>52.285714</td>\n","      <td>78.857143</td>\n","      <td>5.000000</td>\n","      <td>585.320000</td>\n","      <td>117.064000</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1854e56c-491f-11eb-806e-000d3a38a36f</td>\n","      <td>1.571429</td>\n","      <td>20.857143</td>\n","      <td>2.000000</td>\n","      <td>121.970000</td>\n","      <td>60.985000</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>d6ea1074-f1f5-11e9-9346-000d3a38a36f</td>\n","      <td>83.142857</td>\n","      <td>95.428571</td>\n","      <td>2.000000</td>\n","      <td>209.980000</td>\n","      <td>104.990000</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                              master_id  recency_cltv_weekly   T_weekly  frequency  monetary_cltv_avg  monetart_cltv_avg\n","0  cc294636-19f0-11eb-8d74-000d3a38a36f            17.000000  30.571429   5.000000         939.370000         187.874000\n","1  f431bd5a-ab7b-11e9-a2fc-000d3a38a36f           209.857143 224.857143  21.000000        2013.550000          95.883333\n","2  69b69676-1a40-11ea-941b-000d3a38a36f            52.285714  78.857143   5.000000         585.320000         117.064000\n","3  1854e56c-491f-11eb-806e-000d3a38a36f             1.571429  20.857143   2.000000         121.970000          60.985000\n","4  d6ea1074-f1f5-11e9-9346-000d3a38a36f            83.142857  95.428571   2.000000         209.980000         104.990000"]},"execution_count":12,"metadata":{},"output_type":"execute_result"}],"source":["\n","# Monetary değeri satın alma başına ortalama değer olarak, recency ve tenure değerleri ise haftalık cinsten ifade edilecek.\n","\n","cltv_df[\"recency_cltv_weekly\"]=cltv_df[\"recency_cltv_weekly\"]/7\n","cltv_df[\"T_weekly\"]=cltv_df[\"T_weekly\"]/7\n","cltv_df[\"monetart_cltv_avg\"]=cltv_df[\"monetary_cltv_avg\"]/cltv_df[\"frequency\"]\n","cltv_df=cltv_df[cltv_df[\"frequency\"] >1 ]\n","cltv_df.head()\n"]},{"cell_type":"markdown","id":"b3d2ffcb","metadata":{"papermill":{"duration":0.011735,"end_time":"2024-09-11T15:40:12.227391","exception":false,"start_time":"2024-09-11T15:40:12.215656","status":"completed"},"tags":[]},"source":[]},{"cell_type":"markdown","id":"560a62c7","metadata":{"papermill":{"duration":0.011077,"end_time":"2024-09-11T15:40:12.250415","exception":false,"start_time":"2024-09-11T15:40:12.239338","status":"completed"},"tags":[]},"source":["BG/NBD --> Olasılıksal bir modeldir.2 süreci olasılıksal olarak modeller.\n","Transaction Process(Buy) + Dropout Process(Till you die)\n","\n","Transaction Process --> Satın alma işlemi sürecidir.Bir müşteri canlı olduğu sürece kendi transaction rate'si etrafında satın alma yapmaya devam edecektir.\n","\n","Dropout Process --> Bir müşteri alışveriş yaptıktan sonra belirli bir olasılıkla yok olur.\n","\n","\n","\n","CLTV= BG/NBD MOEL * GAMMA GAMMA SUBMODEL\n"]},{"cell_type":"code","execution_count":null,"id":"43c8889e","metadata":{"papermill":{"duration":0.012155,"end_time":"2024-09-11T15:40:12.274622","exception":false,"start_time":"2024-09-11T15:40:12.262467","status":"completed"},"tags":[]},"outputs":[],"source":[]},{"cell_type":"code","execution_count":13,"id":"ad39d55b","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:12.300209Z","iopub.status.busy":"2024-09-11T15:40:12.299753Z","iopub.status.idle":"2024-09-11T15:40:13.003764Z","shell.execute_reply":"2024-09-11T15:40:13.00251Z"},"papermill":{"duration":0.725556,"end_time":"2024-09-11T15:40:13.01235","exception":false,"start_time":"2024-09-11T15:40:12.286794","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["/opt/conda/lib/python3.10/site-packages/pandas/core/arraylike.py:399: RuntimeWarning: invalid value encountered in sqrt\n","  result = getattr(ufunc, method)(*inputs, **kwargs)\n"]},{"data":{"text/plain":["<lifetimes.BetaGeoFitter: fitted with 19945 subjects, a: 0.00, alpha: 76.17, b: 0.00, r: 3.66>"]},"execution_count":13,"metadata":{},"output_type":"execute_result"}],"source":["# GÖREV 3: BG/NBD, Gamma-Gamma Modellerinin Kurulması, CLTV'nin hesaplanması\n","           # 1. BG/NBD modelini fit ediniz.\n","bgf=BetaGeoFitter(penalizer_coef=0.001) ##penalizer_coef --> ceza katsayısıdır.  Beta ve gama parametrelerini bulur.\n","bgf.fit(cltv_df[\"frequency\"],\n","        cltv_df[\"recency_cltv_weekly\"],\n","        cltv_df[\"T_weekly\"])"]},{"cell_type":"code","execution_count":14,"id":"c5eb4ee6","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:13.063834Z","iopub.status.busy":"2024-09-11T15:40:13.063204Z","iopub.status.idle":"2024-09-11T15:40:13.103982Z","shell.execute_reply":"2024-09-11T15:40:13.102735Z"},"papermill":{"duration":0.074913,"end_time":"2024-09-11T15:40:13.107444","exception":false,"start_time":"2024-09-11T15:40:13.032531","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>master_id</th>\n","      <th>recency_cltv_weekly</th>\n","      <th>T_weekly</th>\n","      <th>frequency</th>\n","      <th>monetary_cltv_avg</th>\n","      <th>monetart_cltv_avg</th>\n","      <th>exp_sales_3_months</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>cc294636-19f0-11eb-8d74-000d3a38a36f</td>\n","      <td>17.000000</td>\n","      <td>30.571429</td>\n","      <td>5.000000</td>\n","      <td>939.370000</td>\n","      <td>187.874000</td>\n","      <td>0.973927</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>f431bd5a-ab7b-11e9-a2fc-000d3a38a36f</td>\n","      <td>209.857143</td>\n","      <td>224.857143</td>\n","      <td>21.000000</td>\n","      <td>2013.550000</td>\n","      <td>95.883333</td>\n","      <td>0.983161</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>69b69676-1a40-11ea-941b-000d3a38a36f</td>\n","      <td>52.285714</td>\n","      <td>78.857143</td>\n","      <td>5.000000</td>\n","      <td>585.320000</td>\n","      <td>117.064000</td>\n","      <td>0.670586</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1854e56c-491f-11eb-806e-000d3a38a36f</td>\n","      <td>1.571429</td>\n","      <td>20.857143</td>\n","      <td>2.000000</td>\n","      <td>121.970000</td>\n","      <td>60.985000</td>\n","      <td>0.700412</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>d6ea1074-f1f5-11e9-9346-000d3a38a36f</td>\n","      <td>83.142857</td>\n","      <td>95.428571</td>\n","      <td>2.000000</td>\n","      <td>209.980000</td>\n","      <td>104.990000</td>\n","      <td>0.396039</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                              master_id  recency_cltv_weekly   T_weekly  frequency  monetary_cltv_avg  monetart_cltv_avg  exp_sales_3_months\n","0  cc294636-19f0-11eb-8d74-000d3a38a36f            17.000000  30.571429   5.000000         939.370000         187.874000            0.973927\n","1  f431bd5a-ab7b-11e9-a2fc-000d3a38a36f           209.857143 224.857143  21.000000        2013.550000          95.883333            0.983161\n","2  69b69676-1a40-11ea-941b-000d3a38a36f            52.285714  78.857143   5.000000         585.320000         117.064000            0.670586\n","3  1854e56c-491f-11eb-806e-000d3a38a36f             1.571429  20.857143   2.000000         121.970000          60.985000            0.700412\n","4  d6ea1074-f1f5-11e9-9346-000d3a38a36f            83.142857  95.428571   2.000000         209.980000         104.990000            0.396039"]},"execution_count":14,"metadata":{},"output_type":"execute_result"}],"source":["\n","# a. 3 ay içerisinde müşterilerden beklenen satın almaları tahmin ediniz ve exp_sales_3_month olarak cltv dataframe'ine ekleyiniz.\n","\n","cltv_df[\"exp_sales_3_months\"]=bgf.conditional_expected_number_of_purchases_up_to_time(4*3, ## Bir ay 4 hafta olduğu için.\n","                                                        cltv_df[\"frequency\"],\n","                                                        cltv_df[\"recency_cltv_weekly\"], # Bu değerlerimiz haftalık olduğu için 4*3 yaparız.\n","                                                        cltv_df[\"T_weekly\"])\n","cltv_df.head()"]},{"cell_type":"code","execution_count":15,"id":"accca8fc","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:13.137539Z","iopub.status.busy":"2024-09-11T15:40:13.136672Z","iopub.status.idle":"2024-09-11T15:40:13.163273Z","shell.execute_reply":"2024-09-11T15:40:13.162089Z"},"papermill":{"duration":0.043226,"end_time":"2024-09-11T15:40:13.165896","exception":false,"start_time":"2024-09-11T15:40:13.12267","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>master_id</th>\n","      <th>recency_cltv_weekly</th>\n","      <th>T_weekly</th>\n","      <th>frequency</th>\n","      <th>monetary_cltv_avg</th>\n","      <th>monetart_cltv_avg</th>\n","      <th>exp_sales_3_months</th>\n","      <th>exp_Sales_6_month</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>cc294636-19f0-11eb-8d74-000d3a38a36f</td>\n","      <td>17.000000</td>\n","      <td>30.571429</td>\n","      <td>5.000000</td>\n","      <td>939.370000</td>\n","      <td>187.874000</td>\n","      <td>0.973927</td>\n","      <td>1.947853</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>f431bd5a-ab7b-11e9-a2fc-000d3a38a36f</td>\n","      <td>209.857143</td>\n","      <td>224.857143</td>\n","      <td>21.000000</td>\n","      <td>2013.550000</td>\n","      <td>95.883333</td>\n","      <td>0.983161</td>\n","      <td>1.966323</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>69b69676-1a40-11ea-941b-000d3a38a36f</td>\n","      <td>52.285714</td>\n","      <td>78.857143</td>\n","      <td>5.000000</td>\n","      <td>585.320000</td>\n","      <td>117.064000</td>\n","      <td>0.670586</td>\n","      <td>1.341172</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1854e56c-491f-11eb-806e-000d3a38a36f</td>\n","      <td>1.571429</td>\n","      <td>20.857143</td>\n","      <td>2.000000</td>\n","      <td>121.970000</td>\n","      <td>60.985000</td>\n","      <td>0.700412</td>\n","      <td>1.400824</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>d6ea1074-f1f5-11e9-9346-000d3a38a36f</td>\n","      <td>83.142857</td>\n","      <td>95.428571</td>\n","      <td>2.000000</td>\n","      <td>209.980000</td>\n","      <td>104.990000</td>\n","      <td>0.396039</td>\n","      <td>0.792077</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                              master_id  recency_cltv_weekly   T_weekly  frequency  monetary_cltv_avg  monetart_cltv_avg  exp_sales_3_months  exp_Sales_6_month\n","0  cc294636-19f0-11eb-8d74-000d3a38a36f            17.000000  30.571429   5.000000         939.370000         187.874000            0.973927           1.947853\n","1  f431bd5a-ab7b-11e9-a2fc-000d3a38a36f           209.857143 224.857143  21.000000        2013.550000          95.883333            0.983161           1.966323\n","2  69b69676-1a40-11ea-941b-000d3a38a36f            52.285714  78.857143   5.000000         585.320000         117.064000            0.670586           1.341172\n","3  1854e56c-491f-11eb-806e-000d3a38a36f             1.571429  20.857143   2.000000         121.970000          60.985000            0.700412           1.400824\n","4  d6ea1074-f1f5-11e9-9346-000d3a38a36f            83.142857  95.428571   2.000000         209.980000         104.990000            0.396039           0.792077"]},"execution_count":15,"metadata":{},"output_type":"execute_result"}],"source":["\n","# b. 6 ay içerisinde müşterilerden beklenen satın almaları tahmin ediniz ve exp_sales_6_month olarak cltv dataframe'ine ekleyiniz.\n","# en çok etkileyen etken frequency.\n","cltv_df[\"exp_Sales_6_month\"]=bgf.conditional_expected_number_of_purchases_up_to_time(4*6,\n","                                                                                     cltv_df[\"frequency\"],\n","                                                                                     cltv_df[\"recency_cltv_weekly\"],\n","                                                                                     cltv_df[\"T_weekly\"])\n","\n","cltv_df.head()"]},{"cell_type":"markdown","id":"52056c28","metadata":{"papermill":{"duration":0.012242,"end_time":"2024-09-11T15:40:13.190204","exception":false,"start_time":"2024-09-11T15:40:13.177962","status":"completed"},"tags":[]},"source":["**GAMMA GAMMA SUBMODEL-->** Bir müşterinin işlem başına ortalama ne kadar kar getirebileceğini tahmin etmek için kuklanılır. Bu  yüzden frequency ve monetary üzerine odaklanılır.\n"]},{"cell_type":"code","execution_count":16,"id":"2df7b103","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:13.216712Z","iopub.status.busy":"2024-09-11T15:40:13.216298Z","iopub.status.idle":"2024-09-11T15:40:13.370705Z","shell.execute_reply":"2024-09-11T15:40:13.369283Z"},"papermill":{"duration":0.170764,"end_time":"2024-09-11T15:40:13.373517","exception":false,"start_time":"2024-09-11T15:40:13.202753","status":"completed"},"tags":[]},"outputs":[],"source":["#2. Gamma-Gamma modelini fit ediniz. Müşterilerin ortalama bırakacakları değeri tahminleyip exp_average_value olarak cltv dataframe'ine ekleyiniz.\n","replace_with_threshold(cltv_df,\"frequency\")\n","# cltv_df[\"frequency\"]=cltv_df[\"frequency\"].astype(int)\n","ggf=GammaGammaFitter(penalizer_coef=0.01)\n","ggf.fit(cltv_df[\"frequency\"],cltv_df[\"monetary_cltv_avg\"])\n","cltv_df[\"exp_avg_value\"]=ggf.conditional_expected_average_profit(cltv_df[\"frequency\"],\n","                                                                           cltv_df[\"monetary_cltv_avg\"])\n"]},{"cell_type":"code","execution_count":17,"id":"f1e7042b","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:13.416302Z","iopub.status.busy":"2024-09-11T15:40:13.415184Z","iopub.status.idle":"2024-09-11T15:40:13.439989Z","shell.execute_reply":"2024-09-11T15:40:13.438383Z"},"papermill":{"duration":0.051032,"end_time":"2024-09-11T15:40:13.444473","exception":false,"start_time":"2024-09-11T15:40:13.393441","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>master_id</th>\n","      <th>recency_cltv_weekly</th>\n","      <th>T_weekly</th>\n","      <th>frequency</th>\n","      <th>monetary_cltv_avg</th>\n","      <th>monetart_cltv_avg</th>\n","      <th>exp_sales_3_months</th>\n","      <th>exp_Sales_6_month</th>\n","      <th>exp_avg_value</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>cc294636-19f0-11eb-8d74-000d3a38a36f</td>\n","      <td>17.000000</td>\n","      <td>30.571429</td>\n","      <td>5.000000</td>\n","      <td>939.370000</td>\n","      <td>187.874000</td>\n","      <td>0.973927</td>\n","      <td>1.947853</td>\n","      <td>979.840452</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>f431bd5a-ab7b-11e9-a2fc-000d3a38a36f</td>\n","      <td>209.857143</td>\n","      <td>224.857143</td>\n","      <td>21.000000</td>\n","      <td>2013.550000</td>\n","      <td>95.883333</td>\n","      <td>0.983161</td>\n","      <td>1.966323</td>\n","      <td>2033.366678</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>69b69676-1a40-11ea-941b-000d3a38a36f</td>\n","      <td>52.285714</td>\n","      <td>78.857143</td>\n","      <td>5.000000</td>\n","      <td>585.320000</td>\n","      <td>117.064000</td>\n","      <td>0.670586</td>\n","      <td>1.341172</td>\n","      <td>610.812677</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1854e56c-491f-11eb-806e-000d3a38a36f</td>\n","      <td>1.571429</td>\n","      <td>20.857143</td>\n","      <td>2.000000</td>\n","      <td>121.970000</td>\n","      <td>60.985000</td>\n","      <td>0.700412</td>\n","      <td>1.400824</td>\n","      <td>137.695533</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>d6ea1074-f1f5-11e9-9346-000d3a38a36f</td>\n","      <td>83.142857</td>\n","      <td>95.428571</td>\n","      <td>2.000000</td>\n","      <td>209.980000</td>\n","      <td>104.990000</td>\n","      <td>0.396039</td>\n","      <td>0.792077</td>\n","      <td>235.644166</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>19940</th>\n","      <td>727e2b6e-ddd4-11e9-a848-000d3a38a36f</td>\n","      <td>41.142857</td>\n","      <td>88.428571</td>\n","      <td>3.000000</td>\n","      <td>401.960000</td>\n","      <td>133.986667</td>\n","      <td>0.485785</td>\n","      <td>0.971569</td>\n","      <td>432.377511</td>\n","    </tr>\n","    <tr>\n","      <th>19941</th>\n","      <td>25cd53d4-61bf-11ea-8dd8-000d3a38a36f</td>\n","      <td>42.285714</td>\n","      <td>65.285714</td>\n","      <td>2.000000</td>\n","      <td>390.470000</td>\n","      <td>195.235000</td>\n","      <td>0.480429</td>\n","      <td>0.960859</td>\n","      <td>436.516212</td>\n","    </tr>\n","    <tr>\n","      <th>19942</th>\n","      <td>8aea4c2a-d6fc-11e9-93bc-000d3a38a36f</td>\n","      <td>88.714286</td>\n","      <td>89.857143</td>\n","      <td>3.000000</td>\n","      <td>632.940000</td>\n","      <td>210.980000</td>\n","      <td>0.481605</td>\n","      <td>0.963210</td>\n","      <td>680.115819</td>\n","    </tr>\n","    <tr>\n","      <th>19943</th>\n","      <td>e50bb46c-ff30-11e9-a5e8-000d3a38a36f</td>\n","      <td>98.428571</td>\n","      <td>113.857143</td>\n","      <td>6.000000</td>\n","      <td>1009.770000</td>\n","      <td>168.295000</td>\n","      <td>0.610224</td>\n","      <td>1.220448</td>\n","      <td>1045.723720</td>\n","    </tr>\n","    <tr>\n","      <th>19944</th>\n","      <td>740998d2-b1f7-11e9-89fa-000d3a38a36f</td>\n","      <td>39.571429</td>\n","      <td>91.000000</td>\n","      <td>2.000000</td>\n","      <td>261.970000</td>\n","      <td>130.985000</td>\n","      <td>0.406530</td>\n","      <td>0.813060</td>\n","      <td>293.505198</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>19945 rows × 9 columns</p>\n","</div>"],"text/plain":["                                  master_id  recency_cltv_weekly   T_weekly  frequency  monetary_cltv_avg  monetart_cltv_avg  exp_sales_3_months  exp_Sales_6_month  exp_avg_value\n","0      cc294636-19f0-11eb-8d74-000d3a38a36f            17.000000  30.571429   5.000000         939.370000         187.874000            0.973927           1.947853     979.840452\n","1      f431bd5a-ab7b-11e9-a2fc-000d3a38a36f           209.857143 224.857143  21.000000        2013.550000          95.883333            0.983161           1.966323    2033.366678\n","2      69b69676-1a40-11ea-941b-000d3a38a36f            52.285714  78.857143   5.000000         585.320000         117.064000            0.670586           1.341172     610.812677\n","3      1854e56c-491f-11eb-806e-000d3a38a36f             1.571429  20.857143   2.000000         121.970000          60.985000            0.700412           1.400824     137.695533\n","4      d6ea1074-f1f5-11e9-9346-000d3a38a36f            83.142857  95.428571   2.000000         209.980000         104.990000            0.396039           0.792077     235.644166\n","...                                     ...                  ...        ...        ...                ...                ...                 ...                ...            ...\n","19940  727e2b6e-ddd4-11e9-a848-000d3a38a36f            41.142857  88.428571   3.000000         401.960000         133.986667            0.485785           0.971569     432.377511\n","19941  25cd53d4-61bf-11ea-8dd8-000d3a38a36f            42.285714  65.285714   2.000000         390.470000         195.235000            0.480429           0.960859     436.516212\n","19942  8aea4c2a-d6fc-11e9-93bc-000d3a38a36f            88.714286  89.857143   3.000000         632.940000         210.980000            0.481605           0.963210     680.115819\n","19943  e50bb46c-ff30-11e9-a5e8-000d3a38a36f            98.428571 113.857143   6.000000        1009.770000         168.295000            0.610224           1.220448    1045.723720\n","19944  740998d2-b1f7-11e9-89fa-000d3a38a36f            39.571429  91.000000   2.000000         261.970000         130.985000            0.406530           0.813060     293.505198\n","\n","[19945 rows x 9 columns]"]},"execution_count":17,"metadata":{},"output_type":"execute_result"}],"source":["cltv_df"]},{"cell_type":"code","execution_count":18,"id":"8dabe5c9","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:13.487556Z","iopub.status.busy":"2024-09-11T15:40:13.486796Z","iopub.status.idle":"2024-09-11T15:40:14.078905Z","shell.execute_reply":"2024-09-11T15:40:14.0778Z"},"papermill":{"duration":0.615865,"end_time":"2024-09-11T15:40:14.081292","exception":false,"start_time":"2024-09-11T15:40:13.465427","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>master_id</th>\n","      <th>recency_cltv_weekly</th>\n","      <th>T_weekly</th>\n","      <th>frequency</th>\n","      <th>monetary_cltv_avg</th>\n","      <th>monetart_cltv_avg</th>\n","      <th>exp_sales_3_months</th>\n","      <th>exp_Sales_6_month</th>\n","      <th>exp_avg_value</th>\n","      <th>cltv</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>cc294636-19f0-11eb-8d74-000d3a38a36f</td>\n","      <td>17.000000</td>\n","      <td>30.571429</td>\n","      <td>5.000000</td>\n","      <td>939.370000</td>\n","      <td>187.874000</td>\n","      <td>0.973927</td>\n","      <td>1.947853</td>\n","      <td>979.840452</td>\n","      <td>7340.300758</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>f431bd5a-ab7b-11e9-a2fc-000d3a38a36f</td>\n","      <td>209.857143</td>\n","      <td>224.857143</td>\n","      <td>21.000000</td>\n","      <td>2013.550000</td>\n","      <td>95.883333</td>\n","      <td>0.983161</td>\n","      <td>1.966323</td>\n","      <td>2033.366678</td>\n","      <td>15377.043734</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>69b69676-1a40-11ea-941b-000d3a38a36f</td>\n","      <td>52.285714</td>\n","      <td>78.857143</td>\n","      <td>5.000000</td>\n","      <td>585.320000</td>\n","      <td>117.064000</td>\n","      <td>0.670586</td>\n","      <td>1.341172</td>\n","      <td>610.812677</td>\n","      <td>3150.611024</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1854e56c-491f-11eb-806e-000d3a38a36f</td>\n","      <td>1.571429</td>\n","      <td>20.857143</td>\n","      <td>2.000000</td>\n","      <td>121.970000</td>\n","      <td>60.985000</td>\n","      <td>0.700412</td>\n","      <td>1.400824</td>\n","      <td>137.695533</td>\n","      <td>741.832040</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>d6ea1074-f1f5-11e9-9346-000d3a38a36f</td>\n","      <td>83.142857</td>\n","      <td>95.428571</td>\n","      <td>2.000000</td>\n","      <td>209.980000</td>\n","      <td>104.990000</td>\n","      <td>0.396039</td>\n","      <td>0.792077</td>\n","      <td>235.644166</td>\n","      <td>717.838239</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                              master_id  recency_cltv_weekly   T_weekly  frequency  monetary_cltv_avg  monetart_cltv_avg  exp_sales_3_months  exp_Sales_6_month  exp_avg_value         cltv\n","0  cc294636-19f0-11eb-8d74-000d3a38a36f            17.000000  30.571429   5.000000         939.370000         187.874000            0.973927           1.947853     979.840452  7340.300758\n","1  f431bd5a-ab7b-11e9-a2fc-000d3a38a36f           209.857143 224.857143  21.000000        2013.550000          95.883333            0.983161           1.966323    2033.366678 15377.043734\n","2  69b69676-1a40-11ea-941b-000d3a38a36f            52.285714  78.857143   5.000000         585.320000         117.064000            0.670586           1.341172     610.812677  3150.611024\n","3  1854e56c-491f-11eb-806e-000d3a38a36f             1.571429  20.857143   2.000000         121.970000          60.985000            0.700412           1.400824     137.695533   741.832040\n","4  d6ea1074-f1f5-11e9-9346-000d3a38a36f            83.142857  95.428571   2.000000         209.980000         104.990000            0.396039           0.792077     235.644166   717.838239"]},"execution_count":18,"metadata":{},"output_type":"execute_result"}],"source":["\n","# 3. 6 aylık CLTV hesaplayınız ve cltv ismiyle dataframe'e ekleyiniz.\n","\n","\n","cltv_df[\"cltv\"]=ggf.customer_lifetime_value(bgf,\n","                                 cltv_df[\"frequency\"],\n","                                 cltv_df[\"recency_cltv_weekly\"],\n","                                 cltv_df[\"T_weekly\"],\n","                                 cltv_df[\"monetary_cltv_avg\"],\n","                                 time=6*4, ## Değerlerimiz haftalık olduğu için ve bir ay dört hafta içerdiği için \n","                                 freq=\"W\",\n","                                 discount_rate=0.01  # indirm oranı.Bazı satışlarda indirim yapılmış olabilir.\n","                                 )\n","cltv_df.head()"]},{"cell_type":"code","execution_count":19,"id":"a2fc3d05","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:14.108871Z","iopub.status.busy":"2024-09-11T15:40:14.10841Z","iopub.status.idle":"2024-09-11T15:40:14.12897Z","shell.execute_reply":"2024-09-11T15:40:14.127898Z"},"papermill":{"duration":0.037564,"end_time":"2024-09-11T15:40:14.131575","exception":false,"start_time":"2024-09-11T15:40:14.094011","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>master_id</th>\n","      <th>recency_cltv_weekly</th>\n","      <th>T_weekly</th>\n","      <th>frequency</th>\n","      <th>monetary_cltv_avg</th>\n","      <th>monetart_cltv_avg</th>\n","      <th>exp_sales_3_months</th>\n","      <th>exp_Sales_6_month</th>\n","      <th>exp_avg_value</th>\n","      <th>cltv</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>7330</th>\n","      <td>a4d534a2-5b1b-11eb-8dbd-000d3a38a36f</td>\n","      <td>62.714286</td>\n","      <td>67.285714</td>\n","      <td>52.000000</td>\n","      <td>8643.221000</td>\n","      <td>164.632781</td>\n","      <td>4.697962</td>\n","      <td>9.395924</td>\n","      <td>8677.151978</td>\n","      <td>310767.333528</td>\n","    </tr>\n","    <tr>\n","      <th>4315</th>\n","      <td>d5ef8058-a5c6-11e9-a2fc-000d3a38a36f</td>\n","      <td>133.142857</td>\n","      <td>147.142857</td>\n","      <td>50.000000</td>\n","      <td>7930.031000</td>\n","      <td>160.202646</td>\n","      <td>2.856772</td>\n","      <td>5.713544</td>\n","      <td>7962.418319</td>\n","      <td>176611.213847</td>\n","    </tr>\n","    <tr>\n","      <th>19538</th>\n","      <td>55d54d9e-8ac7-11ea-8ec0-000d3a38a36f</td>\n","      <td>52.571429</td>\n","      <td>58.714286</td>\n","      <td>31.000000</td>\n","      <td>7084.430000</td>\n","      <td>228.530000</td>\n","      <td>3.083779</td>\n","      <td>6.167558</td>\n","      <td>7131.226371</td>\n","      <td>169153.026942</td>\n","    </tr>\n","    <tr>\n","      <th>14181</th>\n","      <td>0e8c7b30-ac18-11e9-a2fc-000d3a38a36f</td>\n","      <td>141.714286</td>\n","      <td>159.714286</td>\n","      <td>48.000000</td>\n","      <td>8180.731000</td>\n","      <td>170.431896</td>\n","      <td>2.628214</td>\n","      <td>5.256428</td>\n","      <td>8215.537936</td>\n","      <td>166084.478474</td>\n","    </tr>\n","    <tr>\n","      <th>10489</th>\n","      <td>7af5cd16-b100-11e9-9757-000d3a38a36f</td>\n","      <td>103.142857</td>\n","      <td>111.857143</td>\n","      <td>43.000000</td>\n","      <td>6755.840000</td>\n","      <td>157.112558</td>\n","      <td>2.978047</td>\n","      <td>5.956093</td>\n","      <td>6787.956882</td>\n","      <td>155490.140120</td>\n","    </tr>\n","    <tr>\n","      <th>10536</th>\n","      <td>e143b6fa-d6f8-11e9-93bc-000d3a38a36f</td>\n","      <td>104.571429</td>\n","      <td>113.428571</td>\n","      <td>40.000000</td>\n","      <td>7048.000000</td>\n","      <td>176.200000</td>\n","      <td>2.763492</td>\n","      <td>5.526983</td>\n","      <td>7084.027731</td>\n","      <td>150581.189903</td>\n","    </tr>\n","    <tr>\n","      <th>8068</th>\n","      <td>d696c654-2633-11ea-8e1c-000d3a38a36f</td>\n","      <td>204.857143</td>\n","      <td>211.857143</td>\n","      <td>50.000000</td>\n","      <td>7882.021000</td>\n","      <td>159.232747</td>\n","      <td>2.214914</td>\n","      <td>4.429828</td>\n","      <td>7914.212666</td>\n","      <td>136101.322027</td>\n","    </tr>\n","    <tr>\n","      <th>14330</th>\n","      <td>90d628b6-1928-11ea-b6a2-000d3a38a36f</td>\n","      <td>98.571429</td>\n","      <td>117.428571</td>\n","      <td>32.000000</td>\n","      <td>7879.521000</td>\n","      <td>246.235031</td>\n","      <td>2.210530</td>\n","      <td>4.421059</td>\n","      <td>7929.920091</td>\n","      <td>134833.393455</td>\n","    </tr>\n","    <tr>\n","      <th>4157</th>\n","      <td>7eed6468-4540-11ea-acaf-000d3a38a36f</td>\n","      <td>89.142857</td>\n","      <td>90.000000</td>\n","      <td>27.000000</td>\n","      <td>7823.630000</td>\n","      <td>289.764074</td>\n","      <td>2.214331</td>\n","      <td>4.428662</td>\n","      <td>7883.009671</td>\n","      <td>134266.262454</td>\n","    </tr>\n","    <tr>\n","      <th>13880</th>\n","      <td>7137a5c0-7aad-11ea-8f20-000d3a38a36f</td>\n","      <td>6.142857</td>\n","      <td>13.142857</td>\n","      <td>11.000000</td>\n","      <td>8338.481000</td>\n","      <td>758.043727</td>\n","      <td>1.970108</td>\n","      <td>3.940216</td>\n","      <td>8495.531325</td>\n","      <td>128739.802938</td>\n","    </tr>\n","    <tr>\n","      <th>5746</th>\n","      <td>6083756a-66a3-11ea-82da-000d3a38a36f</td>\n","      <td>156.142857</td>\n","      <td>157.285714</td>\n","      <td>49.000000</td>\n","      <td>6157.160000</td>\n","      <td>125.656327</td>\n","      <td>2.706955</td>\n","      <td>5.413911</td>\n","      <td>6182.838077</td>\n","      <td>128736.377171</td>\n","    </tr>\n","    <tr>\n","      <th>15611</th>\n","      <td>4a7e875e-e6ce-11ea-8f44-000d3a38a36f</td>\n","      <td>39.714286</td>\n","      <td>40.000000</td>\n","      <td>29.000000</td>\n","      <td>4793.630000</td>\n","      <td>165.297586</td>\n","      <td>3.373958</td>\n","      <td>6.747915</td>\n","      <td>4827.532969</td>\n","      <td>125284.447242</td>\n","    </tr>\n","    <tr>\n","      <th>17462</th>\n","      <td>9d71d5e2-ada9-11e9-a2fc-000d3a38a36f</td>\n","      <td>172.428571</td>\n","      <td>179.000000</td>\n","      <td>44.000000</td>\n","      <td>7190.920000</td>\n","      <td>163.430000</td>\n","      <td>2.241468</td>\n","      <td>4.482935</td>\n","      <td>7224.319533</td>\n","      <td>124555.163481</td>\n","    </tr>\n","    <tr>\n","      <th>18534</th>\n","      <td>8da3ff88-a934-11e9-a2fc-000d3a38a36f</td>\n","      <td>167.857143</td>\n","      <td>176.285714</td>\n","      <td>43.000000</td>\n","      <td>7196.420000</td>\n","      <td>167.358605</td>\n","      <td>2.218034</td>\n","      <td>4.436068</td>\n","      <td>7230.626029</td>\n","      <td>123360.582676</td>\n","    </tr>\n","    <tr>\n","      <th>16335</th>\n","      <td>f24f6988-acd9-11e9-a2fc-000d3a38a36f</td>\n","      <td>172.857143</td>\n","      <td>194.714286</td>\n","      <td>52.000000</td>\n","      <td>6275.680000</td>\n","      <td>110.099649</td>\n","      <td>2.687326</td>\n","      <td>5.374651</td>\n","      <td>6300.335194</td>\n","      <td>119497.608080</td>\n","    </tr>\n","    <tr>\n","      <th>3646</th>\n","      <td>2da98f66-b150-11e9-9757-000d3a38a36f</td>\n","      <td>110.285714</td>\n","      <td>112.428571</td>\n","      <td>33.000000</td>\n","      <td>6518.730000</td>\n","      <td>197.537273</td>\n","      <td>2.332759</td>\n","      <td>4.665519</td>\n","      <td>6559.172345</td>\n","      <td>117693.181589</td>\n","    </tr>\n","    <tr>\n","      <th>6337</th>\n","      <td>f7e2335e-a7c4-11e9-a2fc-000d3a38a36f</td>\n","      <td>245.714286</td>\n","      <td>288.142857</td>\n","      <td>52.000000</td>\n","      <td>7953.470000</td>\n","      <td>143.305766</td>\n","      <td>1.948754</td>\n","      <td>3.897507</td>\n","      <td>7984.698604</td>\n","      <td>112606.735283</td>\n","    </tr>\n","    <tr>\n","      <th>2343</th>\n","      <td>c430fc0e-27ce-11ea-aaaa-000d3a38a36f</td>\n","      <td>88.857143</td>\n","      <td>90.571429</td>\n","      <td>26.000000</td>\n","      <td>6687.080000</td>\n","      <td>257.195385</td>\n","      <td>2.134776</td>\n","      <td>4.269552</td>\n","      <td>6739.820668</td>\n","      <td>110670.766104</td>\n","    </tr>\n","    <tr>\n","      <th>6756</th>\n","      <td>27310582-6362-11ea-a6dc-000d3a38a36f</td>\n","      <td>62.714286</td>\n","      <td>64.142857</td>\n","      <td>29.000000</td>\n","      <td>4897.550000</td>\n","      <td>168.881034</td>\n","      <td>2.793429</td>\n","      <td>5.586858</td>\n","      <td>4932.185303</td>\n","      <td>105976.442321</td>\n","    </tr>\n","    <tr>\n","      <th>12438</th>\n","      <td>625f40a2-5bd2-11ea-98b0-000d3a38a36f</td>\n","      <td>74.285714</td>\n","      <td>74.571429</td>\n","      <td>16.000000</td>\n","      <td>8029.521000</td>\n","      <td>501.845063</td>\n","      <td>1.565309</td>\n","      <td>3.130618</td>\n","      <td>8132.893591</td>\n","      <td>97921.367330</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                                  master_id  recency_cltv_weekly   T_weekly  frequency  monetary_cltv_avg  monetart_cltv_avg  exp_sales_3_months  exp_Sales_6_month  exp_avg_value          cltv\n","7330   a4d534a2-5b1b-11eb-8dbd-000d3a38a36f            62.714286  67.285714  52.000000        8643.221000         164.632781            4.697962           9.395924    8677.151978 310767.333528\n","4315   d5ef8058-a5c6-11e9-a2fc-000d3a38a36f           133.142857 147.142857  50.000000        7930.031000         160.202646            2.856772           5.713544    7962.418319 176611.213847\n","19538  55d54d9e-8ac7-11ea-8ec0-000d3a38a36f            52.571429  58.714286  31.000000        7084.430000         228.530000            3.083779           6.167558    7131.226371 169153.026942\n","14181  0e8c7b30-ac18-11e9-a2fc-000d3a38a36f           141.714286 159.714286  48.000000        8180.731000         170.431896            2.628214           5.256428    8215.537936 166084.478474\n","10489  7af5cd16-b100-11e9-9757-000d3a38a36f           103.142857 111.857143  43.000000        6755.840000         157.112558            2.978047           5.956093    6787.956882 155490.140120\n","10536  e143b6fa-d6f8-11e9-93bc-000d3a38a36f           104.571429 113.428571  40.000000        7048.000000         176.200000            2.763492           5.526983    7084.027731 150581.189903\n","8068   d696c654-2633-11ea-8e1c-000d3a38a36f           204.857143 211.857143  50.000000        7882.021000         159.232747            2.214914           4.429828    7914.212666 136101.322027\n","14330  90d628b6-1928-11ea-b6a2-000d3a38a36f            98.571429 117.428571  32.000000        7879.521000         246.235031            2.210530           4.421059    7929.920091 134833.393455\n","4157   7eed6468-4540-11ea-acaf-000d3a38a36f            89.142857  90.000000  27.000000        7823.630000         289.764074            2.214331           4.428662    7883.009671 134266.262454\n","13880  7137a5c0-7aad-11ea-8f20-000d3a38a36f             6.142857  13.142857  11.000000        8338.481000         758.043727            1.970108           3.940216    8495.531325 128739.802938\n","5746   6083756a-66a3-11ea-82da-000d3a38a36f           156.142857 157.285714  49.000000        6157.160000         125.656327            2.706955           5.413911    6182.838077 128736.377171\n","15611  4a7e875e-e6ce-11ea-8f44-000d3a38a36f            39.714286  40.000000  29.000000        4793.630000         165.297586            3.373958           6.747915    4827.532969 125284.447242\n","17462  9d71d5e2-ada9-11e9-a2fc-000d3a38a36f           172.428571 179.000000  44.000000        7190.920000         163.430000            2.241468           4.482935    7224.319533 124555.163481\n","18534  8da3ff88-a934-11e9-a2fc-000d3a38a36f           167.857143 176.285714  43.000000        7196.420000         167.358605            2.218034           4.436068    7230.626029 123360.582676\n","16335  f24f6988-acd9-11e9-a2fc-000d3a38a36f           172.857143 194.714286  52.000000        6275.680000         110.099649            2.687326           5.374651    6300.335194 119497.608080\n","3646   2da98f66-b150-11e9-9757-000d3a38a36f           110.285714 112.428571  33.000000        6518.730000         197.537273            2.332759           4.665519    6559.172345 117693.181589\n","6337   f7e2335e-a7c4-11e9-a2fc-000d3a38a36f           245.714286 288.142857  52.000000        7953.470000         143.305766            1.948754           3.897507    7984.698604 112606.735283\n","2343   c430fc0e-27ce-11ea-aaaa-000d3a38a36f            88.857143  90.571429  26.000000        6687.080000         257.195385            2.134776           4.269552    6739.820668 110670.766104\n","6756   27310582-6362-11ea-a6dc-000d3a38a36f            62.714286  64.142857  29.000000        4897.550000         168.881034            2.793429           5.586858    4932.185303 105976.442321\n","12438  625f40a2-5bd2-11ea-98b0-000d3a38a36f            74.285714  74.571429  16.000000        8029.521000         501.845063            1.565309           3.130618    8132.893591  97921.367330"]},"execution_count":19,"metadata":{},"output_type":"execute_result"}],"source":["                              \n","# b. Cltv değeri en yüksek 20 kişiyi gözlemleyiniz.\n","cltv_df.sort_values(by=\"cltv\",ascending=False).head(20)\n","\n"]},{"cell_type":"code","execution_count":20,"id":"e71af243","metadata":{"execution":{"iopub.execute_input":"2024-09-11T15:40:14.159605Z","iopub.status.busy":"2024-09-11T15:40:14.159189Z","iopub.status.idle":"2024-09-11T15:40:14.180487Z","shell.execute_reply":"2024-09-11T15:40:14.179417Z"},"papermill":{"duration":0.03834,"end_time":"2024-09-11T15:40:14.183033","exception":false,"start_time":"2024-09-11T15:40:14.144693","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>master_id</th>\n","      <th>recency_cltv_weekly</th>\n","      <th>T_weekly</th>\n","      <th>frequency</th>\n","      <th>monetary_cltv_avg</th>\n","      <th>monetart_cltv_avg</th>\n","      <th>exp_sales_3_months</th>\n","      <th>exp_Sales_6_month</th>\n","      <th>exp_avg_value</th>\n","      <th>cltv</th>\n","      <th>segment</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>cc294636-19f0-11eb-8d74-000d3a38a36f</td>\n","      <td>17.000000</td>\n","      <td>30.571429</td>\n","      <td>5.000000</td>\n","      <td>939.370000</td>\n","      <td>187.874000</td>\n","      <td>0.973927</td>\n","      <td>1.947853</td>\n","      <td>979.840452</td>\n","      <td>7340.300758</td>\n","      <td>A</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>f431bd5a-ab7b-11e9-a2fc-000d3a38a36f</td>\n","      <td>209.857143</td>\n","      <td>224.857143</td>\n","      <td>21.000000</td>\n","      <td>2013.550000</td>\n","      <td>95.883333</td>\n","      <td>0.983161</td>\n","      <td>1.966323</td>\n","      <td>2033.366678</td>\n","      <td>15377.043734</td>\n","      <td>A</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>69b69676-1a40-11ea-941b-000d3a38a36f</td>\n","      <td>52.285714</td>\n","      <td>78.857143</td>\n","      <td>5.000000</td>\n","      <td>585.320000</td>\n","      <td>117.064000</td>\n","      <td>0.670586</td>\n","      <td>1.341172</td>\n","      <td>610.812677</td>\n","      <td>3150.611024</td>\n","      <td>B</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1854e56c-491f-11eb-806e-000d3a38a36f</td>\n","      <td>1.571429</td>\n","      <td>20.857143</td>\n","      <td>2.000000</td>\n","      <td>121.970000</td>\n","      <td>60.985000</td>\n","      <td>0.700412</td>\n","      <td>1.400824</td>\n","      <td>137.695533</td>\n","      <td>741.832040</td>\n","      <td>D</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>d6ea1074-f1f5-11e9-9346-000d3a38a36f</td>\n","      <td>83.142857</td>\n","      <td>95.428571</td>\n","      <td>2.000000</td>\n","      <td>209.980000</td>\n","      <td>104.990000</td>\n","      <td>0.396039</td>\n","      <td>0.792077</td>\n","      <td>235.644166</td>\n","      <td>717.838239</td>\n","      <td>D</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                              master_id  recency_cltv_weekly   T_weekly  frequency  monetary_cltv_avg  monetart_cltv_avg  exp_sales_3_months  exp_Sales_6_month  exp_avg_value         cltv segment\n","0  cc294636-19f0-11eb-8d74-000d3a38a36f            17.000000  30.571429   5.000000         939.370000         187.874000            0.973927           1.947853     979.840452  7340.300758       A\n","1  f431bd5a-ab7b-11e9-a2fc-000d3a38a36f           209.857143 224.857143  21.000000        2013.550000          95.883333            0.983161           1.966323    2033.366678 15377.043734       A\n","2  69b69676-1a40-11ea-941b-000d3a38a36f            52.285714  78.857143   5.000000         585.320000         117.064000            0.670586           1.341172     610.812677  3150.611024       B\n","3  1854e56c-491f-11eb-806e-000d3a38a36f             1.571429  20.857143   2.000000         121.970000          60.985000            0.700412           1.400824     137.695533   741.832040       D\n","4  d6ea1074-f1f5-11e9-9346-000d3a38a36f            83.142857  95.428571   2.000000         209.980000         104.990000            0.396039           0.792077     235.644166   717.838239       D"]},"execution_count":20,"metadata":{},"output_type":"execute_result"}],"source":["## segmentlere ayırınız.\n","cltv_df[\"segment\"]=pd.qcut(cltv_df[\"cltv\"],q=4,labels=[\"D\",\"C\",\"B\",\"A\"])\n","cltv_df.head()"]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[{"datasetId":5661220,"sourceId":9341418,"sourceType":"datasetVersion"}],"dockerImageVersionId":30761,"isGpuEnabled":false,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.10.14"},"papermill":{"default_parameters":{},"duration":45.180631,"end_time":"2024-09-11T15:40:14.918141","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2024-09-11T15:39:29.73751","version":"2.6.0"}},"nbformat":4,"nbformat_minor":5}